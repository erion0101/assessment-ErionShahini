<div class="vl-nav-list">
    <NavLink class="vl-nav-item" href="/user/index" Match="NavLinkMatch.Prefix">
        <span class="oi oi-video" aria-hidden="true"></span>
        <span>My Videos</span>
    </NavLink>
    <NavLink class="vl-nav-item" href="/user/upload">
        <span class="oi oi-plus" aria-hidden="true"></span>
        <span>Upload</span>
    </NavLink>
    <AuthorizeView Roles="Admin">
        <Authorized>
            <NavLink class="vl-nav-item" href="/admin">
                <span class="oi oi-cog" aria-hidden="true"></span>
                <span>Admin</span>
            </NavLink>
        </Authorized>
    </AuthorizeView>
    <AuthorizeView>
        <Authorized>
            <div class="vl-nav-item vl-nav-logout">
                <button type="button" class="vl-btn-logout" @onclick="Logout">
                    <span class="oi oi-account-logout" aria-hidden="true"></span>
                    <span>Logout</span>
                </button>
            </div>
        </Authorized>
    </AuthorizeView>
</div>

@code {
    [Inject] private ApiAuthService AuthService { get; set; } = null!;
    [Inject] private AuthenticationStateProvider AuthenticationStateProvider { get; set; } = null!;
    [Inject] private NavigationManager Navigation { get; set; } = null!;
    [Inject] private IJSRuntime JS { get; set; } = null!;
    [Inject] private IConfiguration Configuration { get; set; } = null!;

    private async Task Logout()
    {
        var apiBaseUrl = Configuration["ApiSettings:BaseUrl"];
        try { await JS.InvokeVoidAsync("logoutClearCookie", apiBaseUrl); }
        catch { }
        await AuthService.LogoutAsync();
        if (AuthenticationStateProvider is JwtAuthenticationStateProvider jwtAuth)
            jwtAuth.NotifyUserLogout();
        Navigation.NavigateTo("/", forceLoad: true);
    }
}
